<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Finder - Search Books by Author</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .search-box {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }
        
        .search-form {
            display: flex;
            gap: 10px;
        }
        
        .search-input {
            flex: 1;
            padding: 15px 20px;
            font-size: 1.1em;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            outline: none;
            transition: border-color 0.3s;
        }
        
        .search-input:focus {
            border-color: #667eea;
        }
        
        .search-button {
            padding: 15px 40px;
            font-size: 1.1em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }
        
        .search-button:hover {
            transform: translateY(-2px);
        }
        
        .search-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .loading {
            text-align: center;
            color: white;
            font-size: 1.2em;
            display: none;
        }
        
        .results {
            display: none;
        }
        
        .results-header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .results-header h2 {
            color: #333;
            font-size: 1.8em;
        }
        
        .book-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .book-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            flex-direction: column;
        }
        
        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .book-cover-container {
            width: 100%;
            height: 200px;
            margin-bottom: 15px;
            border-radius: 10px;
            overflow: hidden;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .book-cover {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .book-cover-placeholder {
            font-size: 4em;
            color: #999;
        }
        
        .book-cover-placeholder {
            font-size: 4em;
            opacity: 0.3;
        }
        
        .book-title {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 12px;
            font-weight: 600;
            line-height: 1.4;
        }
        
        .book-year {
            color: #555;
            font-size: 0.95em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .book-year-label {
            font-weight: 600;
            color: #667eea;
        }
        
        .book-source {
            display: inline-block;
            padding: 5px 12px;
            background: #f0f0f0;
            border-radius: 20px;
            font-size: 0.85em;
            color: #666;
            margin-bottom: 15px;
            width: fit-content;
        }
        
        .book-actions {
            display: flex;
            gap: 10px;
            margin-top: auto;
        }
        
        .book-link {
            flex: 1;
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            transition: transform 0.2s;
            text-align: center;
        }
        
        .book-link:hover {
            transform: scale(1.05);
        }
        
        .book-actions {
            display: flex;
            gap: 10px;
            margin-top: auto;
        }
        
        .book-cover-link {
            display: inline-block;
            padding: 10px 15px;
            background: #f0f0f0;
            color: #667eea;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s;
            font-size: 0.9em;
        }
        
        .book-cover-link:hover {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }
        
        .book-year-label {
            font-weight: 600;
        }
        
        .book-cover-link {
            padding: 10px 20px;
            background: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            transition: transform 0.2s;
            text-align: center;
        }
        
        .book-cover-link:hover {
            transform: scale(1.05);
            background: #218838;
        }
        
        .error {
            background: #ff4444;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            display: none;
        }
        
        .no-results {
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            color: #666;
            font-size: 1.2em;
        }
        
        .pagination-controls {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .pagination-btn {
            padding: 12px 30px;
            font-size: 1em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .pagination-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .pagination-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: #ccc;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Book Finder</h1>
            <p>Search for books by author name</p>
        </div>
        
        <div class="search-box">
            <form class="search-form" id="searchForm">
                <input 
                    type="text" 
                    class="search-input" 
                    id="authorInput" 
                    placeholder="Enter author name (e.g., Isaac Asimov, J.K. Rowling)"
                    required
                >
                <button type="submit" class="search-button" id="searchButton">
                    Search
                </button>
            </form>
        </div>
        
        <div class="loading" id="loading">
            üîç Searching for books...
        </div>
        
        <div class="error" id="error"></div>
        
        <div class="results" id="results">
            <div class="results-header">
                <h2 id="resultsTitle"></h2>
            </div>
            <div class="book-grid" id="bookGrid"></div>
        </div>
    </div>
    
    <script>
        const form = document.getElementById('searchForm');
        const authorInput = document.getElementById('authorInput');
        const searchButton = document.getElementById('searchButton');
        const loading = document.getElementById('loading');
        const error = document.getElementById('error');
        const results = document.getElementById('results');
        const resultsTitle = document.getElementById('resultsTitle');
        const bookGrid = document.getElementById('bookGrid');
        
        let currentAuthor = '';
        let currentPage = 1;
        const booksPerPage = 50;
        
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const author = authorInput.value.trim();
            if (!author) return;
            
            currentAuthor = author;
            currentPage = 1;
            await loadBooks();
        });
        
        async function loadBooks() {
            // Reset UI
            loading.style.display = 'block';
            error.style.display = 'none';
            results.style.display = 'none';
            searchButton.disabled = true;
            bookGrid.innerHTML = '';
            
            try {
                const response = await fetch(`/api/books?author=${encodeURIComponent(currentAuthor)}&page=${currentPage}&limit=${booksPerPage}`);
                const data = await response.json();
                
                loading.style.display = 'none';
                searchButton.disabled = false;
                
                if (!response.ok) {
                    if (response.status === 503) {
                        throw new Error('All book sources are currently unavailable. Please try again later.');
                    }
                    throw new Error(data.error || 'Failed to fetch books');
                }
                
                const pagination = data.pagination;
                
                if (pagination.total_books === 0) {
                    results.style.display = 'block';
                    
                    // Check if it's because source failed
                    if (data.sources && data.sources.open_library && data.sources.open_library.status === 'error') {
                        resultsTitle.textContent = 'Service Temporarily Unavailable';
                        bookGrid.innerHTML = '<div class="no-results">Open Library is currently unavailable. Please try again later.</div>';
                        return;
                    }
                    
                    resultsTitle.textContent = `No books found for "${currentAuthor}"`;
                    bookGrid.innerHTML = '<div class="no-results">Try checking the spelling or searching for another author</div>';
                    return;
                }
                
                // Display results with pagination info
                let titleText = `Found ${pagination.total_books} books by ${data.author}`;
                if (data.partial_results) {
                    titleText += ' ‚ö†Ô∏è';
                }
                titleText += ` (Page ${pagination.page} of ${pagination.total_pages})`;
                resultsTitle.textContent = titleText;
                
                // Show warning message if some sources failed
                if (data.warning) {
                    const warningDiv = document.createElement('div');
                    warningDiv.style.cssText = 'background: #fff3cd; color: #856404; padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #ffc107;';
                    warningDiv.innerHTML = `<strong>‚ö†Ô∏è Partial Results:</strong> ${escapeHtml(data.warning)}`;
                    bookGrid.parentElement.insertBefore(warningDiv, bookGrid);
                }
                
                results.style.display = 'block';
                
                data.books.forEach(book => {
                    const card = document.createElement('div');
                    card.className = 'book-card';
                    
                    const year = book.published_year || 'Unknown';
                    const source = 'Open Library';
                    
                    // Generate cover URL
                    const coverUrl = getCoverUrl(book);
                    const coverHtml = coverUrl 
                        ? `<img src="${coverUrl}" alt="${escapeHtml(book.title)} cover" class="book-cover" onerror="this.parentElement.innerHTML='<div class=\\'book-cover-placeholder\\'>üìö</div>'">`
                        : '<div class="book-cover-placeholder">üìö</div>';
                    
                    // Build actions HTML
                    let actionsHtml = `<a href="${escapeHtml(book.url)}" target="_blank" class="book-link">View Details ‚Üí</a>`;
                    
                    // Add cover link button if available
                    if (coverUrl) {
                        actionsHtml += `<a href="${coverUrl}" target="_blank" class="book-cover-link" title="View Full Cover">üñºÔ∏è Cover</a>`;
                    }
                    
                    card.innerHTML = `
                        <div class="book-cover-container">
                            ${coverHtml}
                        </div>
                        <div class="book-title">${escapeHtml(book.title)}</div>
                        <div class="book-year">
                            <span class="book-year-label">Published:</span>
                            <span>${year}</span>
                        </div>
                        <div class="book-source">${source}</div>
                        <div class="book-actions">
                            ${actionsHtml}
                        </div>
                    `;
                    
                    bookGrid.appendChild(card);
                });
                
                // Add pagination controls
                addPaginationControls(pagination);
                
            } catch (err) {
                loading.style.display = 'none';
                searchButton.disabled = false;
                error.style.display = 'block';
                error.textContent = `Error: ${err.message}`;
            }
        }
        
        function addPaginationControls(pagination) {
            const paginationDiv = document.createElement('div');
            paginationDiv.className = 'pagination-controls';
            paginationDiv.style.cssText = 'display: flex; justify-content: center; align-items: center; gap: 15px; margin-top: 30px; padding: 20px;';
            
            // Previous button
            const prevBtn = document.createElement('button');
            prevBtn.textContent = '‚Üê Previous';
            prevBtn.className = 'pagination-btn';
            prevBtn.disabled = !pagination.has_prev;
            prevBtn.onclick = () => {
                currentPage--;
                loadBooks();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };
            
            // Page info
            const pageInfo = document.createElement('span');
            pageInfo.textContent = `Page ${pagination.page} of ${pagination.total_pages}`;
            pageInfo.style.cssText = 'font-weight: 600; color: #333; font-size: 1.1em;';
            
            // Next button
            const nextBtn = document.createElement('button');
            nextBtn.textContent = 'Next ‚Üí';
            nextBtn.className = 'pagination-btn';
            nextBtn.disabled = !pagination.has_next;
            nextBtn.onclick = () => {
                currentPage++;
                loadBooks();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };
            
            paginationDiv.appendChild(prevBtn);
            paginationDiv.appendChild(pageInfo);
            paginationDiv.appendChild(nextBtn);
            
            bookGrid.parentElement.appendChild(paginationDiv);
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function getCoverUrl(book) {
            // Use thumbnail from API if available
            if (book.thumbnail) {
                return book.thumbnail;
            }
            return null;
        }
    </script>
</body>
</html>
